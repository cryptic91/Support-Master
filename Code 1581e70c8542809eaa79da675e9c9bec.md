# Code

Created by: MD Rakibul Islam Shanto
Created time: December 10, 2024 2:32 PM
Tags: Custom Code

### Template Generator Code

[https://muhtasimmahir.github.io/ZeptoAppsTemplateGenerator/](https://muhtasimmahir.github.io/ZeptoAppsTemplateGenerator/)

### Restrict Upload file format (ex. only .png format is acceptable)

```jsx
$(".pplr-wrapper input.fileupload[name]").each(function () {
    $(this).attr("accept", "image/png")
   $(this).removeAttr("onchange")
    $(this).off("change").on("change", function (event) {
        const file = this.files[0]
        console.log(file, this.files, this)
        if (file?.name?.split(".")[1] == 'png') {
          fileuploadpplr(this,event)
        } else {
            alert("only png image type is allowed")
            this.value = null
            this.files = null
            return
        }
    })
})
```

### How to make text field color required?

```jsx
$('.pplr-swatch-element.pplrColor.color_image_display_box').addClass('cstmfy_c_required').attr('required', true);
```

### How to stop all create new product from theme.liquid

```jsx
$('.pplr-swatch-element.pplrColor.color_image_display_box').addClass('cstmfy_c_required').attr('required', true);
```

### How to prevent Auto Tab Switch

```jsx
window.PPLR_PREVENT_AUTO_TAB = true;
```

### Changing position of App Block with JS

```jsx
$('.product-personalizer').after($('.product-form__option-selector'));
```

### How to disable a field (Image Choice) from clicking using jQuery

```jsx
$(document).ready(function () {
    // Select all elements with name="properties[INCLUSIVE]"
    $('[name="properties[INCLUSIVE]"]').each(function () {
        // Remove the onclick attribute
        $(this).removeAttr('onclick');
        // Disable pointer events to make it non-clickable
        $(this).css('pointer-events', 'none');
        // Optional: Add a class to visually indicate it's disabled (if needed)
        $(this).addClass('disabled');
    });
});

```

### CSS class for Developer Settings

```jsx
tr:has(.cart-item__quantity) -> row class

dl .product-option:not(:first-of-type) -> wrapper class
```

### Product unavailability after creating new product issue

```jsx
window.pplr_atc_delay = 1000;
```

1000 means 1 second; you can add more times if issue persist. If not solved then you can contact us. 

### Making the default quantity 1 in popup

```jsx
$(document).on("click", ".add-monogram-btn", function () {
    $('.q_fi[name="quantity"]').val(1);
});
```

### Dividing price by 4 (Custom work - #65572)

```jsx
$(document).ready(function () {
    let prevPrice = $('.price-list').text().trim(); // Store initial price
    let timeout = null; // Store timeout reference

    let observer = new MutationObserver(function () {
        let newPrice = $('.price-list').text().trim();

        if (newPrice !== prevPrice) { // Only update if price changes
            prevPrice = newPrice; // Update stored price

            // Clear any previous timeout to prevent instant change
            clearTimeout(timeout);

            timeout = setTimeout(function () {
                let price = parseFloat(newPrice.replace(/[^0-9.]/g, ''));
                if (!isNaN(price)) {
                    $('.4fois').text((price / 4).toFixed(2));
                }
            }, 2000); // 2-second delay
        }
    });

    observer.observe(document.querySelector('.price-list'), {
        childList: true,
        subtree: true,
        characterData: true
    });
});
```

The total price gets divided by 4 after every time change of price. It will work after 2 seconds delay. 

![image.png](Code/image.png)

### Trigger code for custom button â€˜Personalize itâ€™ (Custom - #65576)

```jsx
$(document).ready(function() {
     $('.zeptoCustomButton').on('click', function(event) {
         cstmfy_personalize_text(this, event);
     });
});
```

![image.png](Code/image%201.png)

### JS for filtering words in text field (custom - #65565)

```jsx
document.addEventListener("DOMContentLoaded", function () {
  // Select the textarea element
  const textarea = document.querySelector('textarea[name="properties[Single Line Text]"]');

  if (textarea) {
    // Add an event listener for the 'input' event
    textarea.addEventListener("input", function (event) {
      // Get the current value of the textarea
      let inputText = event.target.value;

      // Define the words to filter (case-insensitive)
      const wordsToFilter = ["india", "abcd", "zepto"];

      // Create a regular expression to match any of the words
      const regex = new RegExp(`\\b(${wordsToFilter.join("|")})\\b`, "gi");

      // Remove the filtered words
      inputText = inputText.replace(regex, "");

      // Update the textarea value with the filtered text
      event.target.value = inputText;
    });
  } else {
    console.error("Textarea not found!");
  }
});
```

```jsx
<script src="{{ 'customwork.js' | asset_url }}" defer="defer" type="text/javascript"></script>
```

### Showing product image in cart page

```html
<img class="pplr_original_img">
```

### COGS / loader icon change with CSS

```css
.pplr_loader {
   background: url('https://cdn.shopify.com/s/files/1/0670/1734/3033/files/Gif-Aurora.gif?v=1729181642') !important;
   background-repeat: no-repeat !important;
   background-position: center !important;
}
```

```css
.pplr_loader {
   visibility: none !important;
}
```

### Blocking â€˜spaceâ€™ button from the input field (custom - #66551)

```jsx
$(document).ready(function () {
    $(document).on('keydown', '.pplr_text.pplr_monogram', function (event) {
        if (event.key === ' ' || event.keyCode === 32) {
            event.preventDefault();
        }
    });
});
```

### Showing 1 quantity price even after updating the quantity in product page

```jsx
window.pplr_no_qty_update = true;
```

### Disabling viewport/ pplr_meta to enable the zooming in mobile

```jsx
window.pplr_no_meta = true;
```

### Checkbox CSS

```css
input[type="checkbox"].pplrcheckbox {
  appearance: auto !important;
  -webkit-appearance: checkbox !important;
  -moz-appearance: checkbox !important;
  width: 16px !important;
  height: 16px !important;
  display: inline-block !important;
  visibility: visible !important;
  opacity: 1 !important;
  position: static !important;
  clip: auto !important;
  margin: 5px;
}
```

```css
.pplr-wrapper label {
    width: auto !important;
    float: left !important;
    margin-right: 8px !important;
    padding: 10px 0px !important;
}

input[type=checkbox] {
    display: inline-block !important;
    width: auto !important;
    margin: 0px 3px !important;
}
```

### Making Radio button from Checkbox using CSS

```css
input[type="checkbox"] {
  appearance: none;
  -webkit-appearance: none;
  width: 16px;
  height: 16px;
  border: 2px solid #555;
  border-radius: 50%;
  position: relative;
  cursor: pointer;
  vertical-align: middle;
  margin-right: 8px;
}

input[type="checkbox"]:checked::before {
  content: "";
  position: absolute;
  top: 4px;
  left: 4px;
  width: 6px;
  height: 6px;
  background-color: #555;
  border-radius: 50%;
}
```

### JS code for changing popup button name

```jsx
const button = document.querySelector('button.btn.pplr-c-button.pplr-btn.button.Button--secondary.ptc_button');
if (button) {
  button.textContent = "Make It Yours";
}
```

### Extension JS code for copying the myshopify URL

```jsx
// ==UserScript==
// @name         Add Copy Button for myshopify Domain on Zendesk
// @namespace    http://tampermonkey.net/
// @version      1.0
// @description  Add "Copy myshopify domain" button beside links in Zendesk that contain shop=xxx.myshopify.com
// @author       Rakib
// @match        https://product-personalizer.zendesk.com/*
// @grant        GM_setClipboard
// ==/UserScript==

(function () {
    'use strict';

    const observer = new MutationObserver(() => {
        const links = document.querySelectorAll('a[href*="shop="]');
        links.forEach(link => {
            const href = link.href;
            if (link.nextSibling && link.nextSibling.classList && link.nextSibling.classList.contains('copy-myshopify-btn')) {
                return; // Button already exists
            }

            const match = href.match(/shop=([a-zA-Z0-9\-]+\.myshopify\.com)/);
            if (match && match[1]) {
                const domain = match[1];
                const btn = document.createElement('button');
                btn.textContent = 'ðŸ“‹ Copy shop domain';
                btn.style.marginLeft = '6px';
                btn.style.padding = '2px 6px';
                btn.style.fontSize = '12px';
                btn.style.cursor = 'pointer';
                btn.style.borderRadius = '4px';
                btn.style.border = '1px solid #ccc';
                btn.className = 'copy-myshopify-btn';

                btn.addEventListener('click', function (e) {
                    e.preventDefault();
                    GM_setClipboard(domain);
                    btn.textContent = 'âœ… Copied!';
                    setTimeout(() => (btn.textContent = 'ðŸ“‹ Copy shop domain'), 2000);
                });

                link.parentNode.insertBefore(btn, link.nextSibling);
            }
        });
    });

    observer.observe(document.body, { childList: true, subtree: true });
})();

```

### Calendar / Changing format of date to â€˜dd/mm/yyyyâ€™

```jsx
jQuery("head").append('<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">')
loadScript_p("https://cdn.jsdelivr.net/npm/flatpickr", () => {
    jQuery('.pplr-wrapper input[type="date"]').attr("placeholder", 'dd.mm.yyyy')
    flatpickr('.pplr-wrapper input[type="date"]', {
        dateFormat: "d.m.Y",
         allowInput: true
     })

Object.keys(pplr_values).map((key) => {
    if(pplr_values[key][38] == 5){
        pplr_values[key][38] = 1
    }
})
})
```

### â€˜Out of Stockâ€™ text change + color modify

```css
*, *::before, *::after {
    box-sizing: inherit;
    color: black !important;
}
.vrdisabled::before {
    content: 'Sold Out' !important;
}
```

### How to design the ATC button with an image

```jsx
var tries = 0;
var maxTries = 60;

function checkZeptoButton() {
  var zeptoOriginal = document.querySelector("button.ptc_button");
  if (zeptoOriginal) {
    var container = zeptoOriginal.closest(".product-personalizer");
    if (!container) container = zeptoOriginal.parentNode;
    container.innerHTML = "";

    var wrapper = document.createElement("div");
    wrapper.className = "zepto-wrapper";

    var img = document.createElement("img");
    img.className = "carcasas-trio";
    img.src = "https://cdn.shopify.com/s/files/1/0628/6006/6873/files/billeterasmuestra.png?v=1749052464";
    img.alt = "Tres carcasas Limited â€“ personaliza aquÃ­";
    img.onerror = function() {
      console.warn("Image failed to load, hiding img.");
      img.style.display = "none";
    };

    var customBtn = document.createElement("button");
    customBtn.className = "zepto-custom-btn";
    customBtn.textContent = "Personaliza aquÃ­!";

    wrapper.appendChild(img);
    wrapper.appendChild(customBtn);
    container.appendChild(wrapper);

    zeptoOriginal.style.display = "none";
    container.appendChild(zeptoOriginal);

    customBtn.addEventListener("click", function() {
      zeptoOriginal.click();
    });
  } else {
    tries++;
    if (tries < maxTries) setTimeout(checkZeptoButton, 300);
  }
}

checkZeptoButton();

```

### All Code

```jsx
1. window.pplr_atc_delay = 1000; 
2. window.pplr_svg2pdf = true; 
3. window.pplr_no_qty_update = true; 
4. window.pplr_create_disabled = true; 
5. window.pplr_no_carousel= true;
6. window.pplr_custom_allowed_types = ['mp4a']; // ['jpg','jpeg','png','gif','webp','avif','bmp','svg','svg+xml','heic'] 
6. window.PPLR_PREVENT_AUTO_TAB = true; 
7. window.pplr_currency_adjust = true; 
8. window.pplr_shopify_file_size=7; 
9. window.pplr_slide_animation=false; 
10. window.pplr_s3_upload = true; 
11. pplr_hide_attributes_from_bundle = false; 
12. show_additionl_product = true; 
13. window.pplr_date_format = "dd-mm-yyyy" 
```

### JS code to force for p_a_t_c class in ATC button

```jsx
$('.product-form,.pplrform').find('[name="add"][type="submit"]').addClass("p_a_t_c")
```

### How to check price from console?

```jsx
document.querySelectorAll('[data-pplr_price]').forEach(el => {
  console.log(el.getAttribute('name'), el.dataset.pplr_price);
});
```

### (Personal) Asset image delete code from console

```jsx
deleteFontImage(window.sets.images.store.splice(0, 100), 'image')
```

### For color required set for text fields.

```jsx
$(".pplrgcolor").siblings("input.cstmfy_c_required").val("").attr("data-value", "").attr("value", "").attr("data-type", "5")
$(".pplrgcolor .selected").removeClass("selected")

var prev_pplr_check_require = pplr_check_require;
window.pplr_check_require = (pplrtis,e,k) => {
    $(".pplrgcolor").siblings("input.cstmfy_c_required").each(function(){
        if($(this).attr('data-type') == 5){
            $(this).attr("data-value", "").val("")
        }
    })
    prev_pplr_check_require(pplrtis,e,k);
}
```

### To change the extra keyboard color & icon

New format
```css
.key_layout_sub {
color: red !important;   /* this for color */
}

.key_layout span {
     border-radius: 60px !important;
}
```
```js
var prev_cstmfy_personalize_text = cstmfy_personalize_text;
 $('.key_layout_sub').text('â„ž')
window. cstmfy_personalize_text = (a, b) => {
prev_cstmfy_personalize_text(a, b)
   $('.key_layout_sub').text('â„ž')
}
```

Old format
```css
.key_layout_sub {
color: red !important;   /* this for color */
}

.key_layout_sub {
font-size: 0;      /* for hiding the old emoji */
}

.key_layout_sub::before {
content: "ðŸ–®";      /* this for new emoji or icon */
font-size: 4rem;    /* here you can adjust the size of the new icon */
}
```

### Js to capitalize first character of every word

```jsx
$(document).ready(function() {
  $(document).on('input', '.pplr_text', function() {
    $(this).val($(this).val().replace(/\b\w/g, txt => txt.toUpperCase()));
    console.log('Input changed!'); // console check
  });
});
```

```jsx
<script src="{{ 'custom-script.js' | asset_url }}" defer="defer" type="text/javascript"></script>

```

![image.png](Code/image%202.png)

### To block entering emoji in the text field

```jsx
$(document).on('input', '.pplr-wrapper .pplr_text', function () {
        this.value = this.value.replace(
            /([\uD83C-\uDBFF\uDC00-\uDFFF]+)/g,
            ''
        );
    });
```

### Packing slip (usually from 132 line)

```jsx
{%- comment -%}ZPPLR_PROPS_BLOCK{%- endcomment -%}

{% for p in line_item.properties %}

  {% unless p.last == blank %}

    {{ p.first }}:

    {% if p.last contains '/uploads/' or p.last contains '/assets/' or p.last contains '/products/' %}
      <img style="width:50px;height:auto" src="{{ p.last }}" />
    {% else %}
      {{ p.last | newline_to_br }}
    {% endif %}

    <br>

  {% endunless %}

{% endfor %}
```

### Mobile sticky preview size CSS

```css
@media (max-width: 768px) {
  .pplr-prev-left {
      width: 60% !important;
  }

  .pplrabs {
      display: flex;
      justify-content: center;
      background: white;
  }
}
```

### Test

```jsx
$(".pplrgcolor").siblings("input.cstmfy_c_required").val("").attr("data-value", "").attr("value", "").attr("data-type", "5")
$(".pplrgcolor .selected").removeClass("selected")

var prev_pplr_check_require = pplr_check_require;
window.pplr_check_require = (pplrtis,e,k) => {
    $(".pplrgcolor").siblings("input.cstmfy_c_required").each(function(){
        if($(this).attr('data-type') == 5){
            $(this).attr("data-value", "").val("")
        }
    })
    prev_pplr_check_require(pplrtis,e,k);
}
```
